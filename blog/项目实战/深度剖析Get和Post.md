# 深度剖析Get和Post

## 浅谈Get和Post请求对的区别

> 面试经验

GET和POST是HTTP请求的两种基本方法，要说它们的区别，接触过WEB开发的人都能说出一二。

最直观的区别就是GET把参数包含在URL中，POST通过request body传递参数。

你可能自己写过无数个GET和POST请求，或者已经看过很多权威网站总结出的他们的区别，你非常清楚知道什么时候该用什么。

当你在面试中被问到这个问题，你的内心充满了自信和喜悦。

你轻轻松松的给出了一个“标准答案”。

**“很遗憾，这不是我们要的回答！”**

> 灵魂十八问

请告诉我真相。。。

如果我告诉你GET和POST本质上没有区别你信吗？

让我们扒下GET和POST的外衣，坦诚相见吧！

Get和Post是什么？

HTTP协议中的两种发送请求的方法。

HTTP是什么？

HTTP是基于TCP/IP的关于数据如何在万维网中如何通信的协议。

HTTP的底层是TCP/IP。所以Get个和Post的的底层也是TCP/IP，也就是说，Get/Post都是TCP链接。Get和Post能做的事情是一模一样的。你要给Get加上request body，给post带上url参数，技术上是完全行的通的。

那么，“标准答案”里的那些区别是怎么回事？

在我大万维网世界中，TCP就像汽车，我们用TCP来运输数据，它很可靠，从来不会发生丢件少件的现象。但是如果路上跑的全是看起来一模一样的汽车，那这个世界看起来是一团混乱，送急件的汽车可能被前面满载货物的汽车拦堵在路上，整个交通系统一定会瘫痪。为了避免这种情况发生，交通规则HTTP诞生了。HTTP给汽车运输设定了好几个服务类别，有GET, POST, PUT, DELETE等等，HTTP规定，当执行GET请求的时候，要给汽车贴上GET的标签（设置method为GET），而且要求把传送的数据放在车顶上（url中）以方便记录。如果是POST请求，就要在车上贴上POST的标签，并把货物放在车厢里。当然，你也可以在GET的时候往车厢内偷偷藏点货物，但是这是很不光彩；也可以在POST的时候在车顶上也放一些数据，让人觉得傻乎乎的。HTTP只是个行为准则，而TCP才是GET和POST怎么实现的基本。

但是，我们只看到HTTP对GET和POST参数的传送渠道（url还是requrest body）提出了要求。“标准答案”里关于参数大小的限制又是从哪来的呢？

在我大万维网世界中，还有另一个重要的角色：运输公司。不同的浏览器（发起http请求）和服务器（接受http请求）就是不同的运输公司。 虽然理论上，你可以在车顶上无限的堆货物（url中无限加参数）。但是运输公司可不傻，装货和卸货也是有很大成本的，他们会限制单次运输量来控制风险，数据量太大对浏览器和服务器都是很大负担。业界不成文的规定是，（大多数）浏览器通常都会限制url长度在2K个字节，而（大多数）服务器最多处理64K大小的url。超过的部分，恕不处理。如果你用GET服务，在request body偷偷藏了数据，不同服务器的处理方式也是不同的，有些服务器会帮你卸货，读出数据，有些服务器直接忽略，所以，虽然GET可以带request body，也不能保证一定能被接收到哦。

好了，现在你知道，GET和POST本质上就是TCP链接，并无差别。但是由于HTTP的规定和浏览器/服务器的限制，导致他们在应用过程中体现出一些不同。

> 大Boss

你以为本文就这么结束了？

我们的大BOSS还等着出场呢。。。

这位BOSS有多神秘？当你试图在网上找“GET和POST的区别”的时候，那些你会看到的搜索结果里，从没有提到他。他究竟是什么呢。。。

GET和POST还有一个重大区别，简单的说：

GET产生一个TCP数据包；POST产生两个TCP数据包。

长的说：

对于GET方式的请求，浏览器会把http header和data一并发送出去，服务器响应200（返回数据）；

而对于POST，浏览器先发送header，服务器响应100 continue，浏览器再发送data，服务器响应200 ok（返回数据）。

也就是说，GET只需要汽车跑一趟就把货送到了，而POST得跑两趟，第一趟，先去和服务器打个招呼“嗨，我等下要送一批货来，你们打开门迎接我”，然后再回头把货送过去。

因为POST需要两步，时间上消耗的要多一点，看起来GET比POST更有效。因此Yahoo团队有推荐用GET替换POST来优化网站性能。但这是一个坑！跳入需谨慎。为什么？

1. GET与POST都有自己的语义，不能随便混用。

2. 据研究，在网络环境好的情况下，发一次包的时间和发两次包的时间差别基本可以无视。而在网络环境差的情况下，两次包的TCP在验证数据包完整性上，有非常大的优点。

3. 并不是所有浏览器都会在POST中发送两次包，Firefox就只发送一次。
   

> 基本区别

- 可见性：Get请求参数在URL用户可以看见，Post请求参数在request body中不会被用户看见
- 安全性：Get比Post更不安全，因为参数直接暴露在URL上，所以不能用来传递敏感信息
- 编码方式：Get请求只能进行URL编码，而POST支持多种编码方式
- 数据类型：Get只接受ASCII字符，而Post没有
- 长度限制：Get请求在URL中传递的参数有长度限制，参数一般限制2048（和Web服务相关），而Post没有
- 重复提交：Get在浏览器刷新或者回退是是无害的，而Post的话数据会被重新提交
- Get产生的URL地址可以被Bookmark，而Post不可以
- Get请求会被浏览器主动cache，而Post不会，除非手动设置
- Get请求参数会被完整保留在浏览器历史记录里，而Post中的参数不会被保留

> 请求的时候

- Get是将数据中的header和data一起发送给服务端，返回code
- Post是现将header发送给服务器返回100 continue,再发送data给服务器，返回code
- Get请求就发送了一个TCP数据包给服务器，而Post发送了两次数据包给服务器

## 剖析Get和Post请求的区别

> HTTP认知

1. HTTP是基于TCP/IP的关于数据如何在万维网中如何通信的协议。HTTP的底层是TCP/IP，所以Get和Post的底层也是TCP/IP，也就是说，Get个Post本质上就是TCP连接，并无差别。HTTP只是个行为准则，而TCP才是Get和Post怎么实现的基本。
2. HTTP定义了与服务器交互的不同方法，最基本的方法有4中，分别是Get、Post、Put和Delete。URL全程是统一资源定位符。它们本质上就是TCP连接，但是由于HTTP的规定和浏览器/服务器的限制，导致它们在应用过程中体现出一些不同。
3. 简单理解：一个URL地址，它用于描述一个网络上的资源，而HTTP中的Get、Post、Put和Delete就对应这这个资源的差、改、增和删4个操作。Get一般用户获取/查询资源信息，而Post一般用于更新资源信息，Put一般用于增加资源信息，delete一般用于删除资源信息。

> RFC探秘

**RFC定义**

征求意见稿（英文：Request For Comments，缩写为RFC），是有互联网工程任务组（IETF）发布的一系列被网络。文件手机里有关互联网相关信息，以及UNIX和互联网社区的软件文件，以编号排定。目前RFC文件是由互联网协会（ISOC）赞助发行。

**RFC理解**

简单理解RFC就是互联网的规范，我们通常所说的【协议】就是以RFC的形式存在。

RFC7231里定义了HTTP方法的几个性质：

- Safe-安全。这里的【安全】和通常理解的【安全】意义不同，如果一个方法的语义在本质上是【只读】的，那么这个方法胡原始股爱不起眼的，客户端想服务端的资源发起的请求如果使用的是安全的方法，就不应该引起服务端的任何状态变化，因此也是无害的。此时RFC定义，Get、Head、Options和Trace这几个方法是安全的，服务端的实现可能会不符合方法语义，正如上文所说过的使用Get修改用户信息的情况。引入安全这个大概念是为了方便网络爬虫和缓存，以免调用或者缓存某些不安全方法引起某些意外的后果。User Agent（浏览器）应该在执行安全和不安全方法时做出区分对待，并给用户以提示。
- IDempotent-幂等。幂等的概念是指同一个请求方法执行多次和执行一次的效果安全相同。按照RFC规范，Put，Delete和安全方法都是幂等的。同样，这也仅仅是规范，服务端实现是否幂等是无法确保的。引入幂等主要是为了处理同一个请求发送的情况，比如在请求响应前失去连接，如果方法是幂等的，就可以放心的重发一次请求。这也是浏览器在后退/刷新时遇到Post会给用户提示的原因：Post语义不是幂等的，重复请求可能会带来意想不到的后果。
- Cacheable-可缓存性。顾名思义就是一个方法是否可以被缓存，此RFC里Get、Head和某些情况下的Post都是可缓存的，但是绝大多数的浏览器的实现里仅仅支持Get和Head。

> Get和Post请求方式的区别

1. Get和Post本质上都是TCP连接，所以本质上并没有区别
2. Get和Post有一个重大区别：Get产生一个TCP数据包；Post产生两个TCP数据包。但并不是所有浏览器都会在Post中发送两次包，Firefox就只发送一次。
3. Get和Post的最直观区别是：Get把参数包含在URL中，Post通过request body传递参数
4. Get和Post表面上的区别：
   - Get是从服务器获取数据，Post是向服务器传送数据。Get和Post只是一种传递数据的方式，Get也可以把数据传到服务器，他们的本质上都是发送请求和接受结果。只是组织格式和数据量上面有差别。
   - Get是把参数数据了队列加到表单的Action属性所指的URL中，值和表单内各个字段一一对应，在URL中可以看到，Post是通过HTTP post机制，将表单内各个字段内容放置在Html Header内一起传送到Action属性所指的URL地址，用户看不到这个过程。
   - 对于Get方式，服务端用Request.QueryString获取变量值，对于Post方式，服务端用Request.Form获取提交的数据。
   - Get传送的数据量较小，不能大于2kb。Post传送的数据量较大，一般被默认为不受限制。但理论上。IIS4中最大量为80Kb，IIS5中为100kb。Post基本没有限制。
   - Get安全性非常低，Post安全性较高。因为参数直接暴露在URL上，所以不建议使用Get请求来传递敏感信息。
   - Get在浏览器回退时是无害的，而Post会再次提交请求
   - Get请求只能进行URL编码，而Post支持多种编码方式
   - Ger请求会被浏览器主动缓存，而Post不会，除非手动设置。Get请求参数会被完整保留在浏览器历史记录里面，而Post中的参数不会被保留。
   - Get请求在URL中传送的参数是有长度限制的，而Post没有。对于参数类型，Get值接收ASCII字符，而Post没有限制。

> 其他相关区别

1. 对于Get请求，浏览器会把HTTP Header和data一并发送出去，发武器响应200（返回数据）；对于Post，浏览器先发送Header,服务器响应100 continue，浏览器再发送data，服务器响应200 ok （返回数据）。
2. Get的语义是请求获取指定的资源。Get方法是安全、幂等、可缓存的。由于Get请求一般是用于资源信息的获取而非修改，所以Get意味着所谓的安全。换言之，Get请求一般不会产生副作用，它仅仅是获取资源信息，就像数据库查询一样，不会改变数据，不会影响资源的状态。所以，Get请求一般不会改变服务器的状态。幂等意味着对于同一个URL的多个请求应该返回同样的结果。Get方法的报文主题没有任何语义。
3. Post的语义是根据请求负荷（报文主体），对指定的资源做出处理，具体的处理方式视资源类型而不同。Post不安全，不幂等，（大部分实现）不可缓存
4. Get是通过URL方式请求，可以直接看到，明文传输。Post是通过请求Header请求，通过开发者工具或者抓包可以看到，同样也是明文的。