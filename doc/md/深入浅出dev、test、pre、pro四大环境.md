# 深入浅出dev、test、pre、pro四大环境

https://www.jianshu.com/p/abca29f84dc1

四个环境分别是：pro、pre、test、dev环境

中文名字：生产环境、灰度环境、测试环境、开发环境

今天给大家介绍一下开发过程中，四个环境以及各自的功能特点，其实大家看英文应该就差不多可以看出来对应的是什么环境。

## 环境介绍

pro环境：生产环境，面向外部用户的环境，连接上互联网即可访问的正式环境。

pre环境：灰度环境，外部用户可以访问，但是服务器配置相对低，其它和生产一样。

test环境：测试环境，外部用户无法访问，专门给测试人员使用的，版本相对稳定。

dev环境：开发环境，外部用户无法访问，开发人员使用，版本变动很大。

## 分成环境原因

大多数人都知道四个环境指的是什么，但是很多人却不知道为什么要这么区别，甚至为了省事就只有dev和pro环境。如果项目没有上线之前没有问题，如果项目上线之后就会有非常麻烦的事情发生。下面我们针对这四种环境，来分析一下对应的各种场景。

### dev+pro

如果我们只有dev和pro环境，pro突然发现bug，需要紧急处理，只有两个环境，这个时候我们要如何解决呢？？？


首先dev现在已经更新到1.1.0，而pro现在才1.0.0，所以这个时候我们需要重新创建一个brunch分支，这边我们可以叫做1.0.0.1,然后修改代码之后需要放到dev环境上面进行测试，这个时候就会变成如下所示状态：




然后测试通过之后，我们需要将1.0.0.1发布到pro环境，然后合并1.0.0.1的代码到1.1.0中，最后将dev环境修改为1.1.1，如下所示：


在dev1.0.0.1测试期间，所以开发工作全部得停止，必须等测试通过发布到生产上面才可以，如果仅仅只有两个环境，代价实在是太大了！！

dev+test+pro
如果我们多了一个test环境情况就会好很多了，比如上面说所的问题，我们就可以这么来处理。


我们可以在test1.0.0上面直接修改，修改后的版本是1.0.0.1，测试通过之后直接发布到pro环境即可。然后再将test中1.0.0.1代码合并到1.1.0，最后dev的版本升一级就可以了。


这样的好处就是不会影响dev开发环境，不管怎么修改test，都不会造成dev暂停。

dev+test+pre+pro
如果test环境和pro环境版本不同步，还是会有问题存在，比如test环境在测试1.0.1版本的代码而生产上面运行的是pro环境的代码，这个时候pro出现问题修改的时候就会比较麻烦。


这个时候和之前的做法一样，创建一个新的brunch分支（1.0.0.1）然后在1.0.0.1中修复bug，然后发布到test最新版本中，测试通过之后发布到pro环境中。然后就是复杂的合代码操作了，将1.0.0.1代码合并到1.0.1中，将dev的1.1.0添加上修复的代码变成1.1.1。


这种情况下，首先在test测试期间，1.0.1的测试工作会停止，其次步骤太繁琐，所以这边我们新增了pre环境。


我们只要保证pre的版本和pro环境的版本一致，就可以解决上面的问题了。如上图所示，我们只需要在pre的1.0.0环境上面修复bug就可以了，修复好之后发布到pro环境就可以了，然后将代码同步到test和dev中即可。


这样以后不管pro遇到什么问题，我们都可以按照上面的步骤来解决。

